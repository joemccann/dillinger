
$(function(){function y(a,b){(function(c,d){var e=c.createElement(d),f=c.getElementsByTagName(d)[0];e.async=1,e.src=a,f.parentNode.insertBefore(e,f),e.onload=function(){b&&b()}})(document,"script")}function z(){var a;try{localStorage.getItem&&(a=localStorage)}catch(b){}return a}function A(){var a;try{a=JSON.parse(localStorage.profile),a=$.extend(!0,k,a)}catch(b){a=k}k=a}function B(a){localStorage.clear(),localStorage.profile=JSON.stringify($.extend(!0,k,a))}function C(a){return E(a,"pfx")}function D(a,b){for(var c in a)if(n[a[c]]!==undefined)return b==="pfx"?a[c]:!0;return!1}function E(a,b){var c=a.charAt(0).toUpperCase()+a.substr(1),d=(a+" "+o.join(c+" ")+c).split(" ");return D(d,b)}function F(){var a={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"msTransitionEnd",transition:"transitionEnd"};return a[C("transition")]}function G(a){return"dillinger_"+(new Date).toISOString().replace(/[\.:-]/g,"_")+"."+a}function H(){return $('#filename > p[contenteditable="true"]').text()}function I(a){$('#filename > p[contenteditable="true"]').text(a||k.current_filename||"Untitled Document")}function J(){z()?($.support.transitionEnd=F(),A(),K(),L(),d=new Showdown.converter,Z(),bd(),be(),bf(),bg(),bc(),O()):X()}function K(){c=ace.edit("editor"),R(k.theme,function(){c.getSession().setUseWrapMode(!0),c.setShowPrintMargin(!1);var a=require("ace/mode/markdown").Mode;c.getSession().setMode(new a),c.getSession().setValue(k.currentMd||c.getSession().getValue()),T()})}function L(){r.find('option[value="'+k.theme+'"]').attr("selected",!0),s.css("backgroundImage",k.showPaper?'url("'+j+'")':'url("")'),t.text(k.autosave.enabled?"Disable Autosave":"Enable Autosave"),h=v.attr("data-github-user"),h&&bh.showMessage("What's Up "+h,1e3),g=p.css("right"),I()}function M(){c.getSession().setValue(""),T()}function N(a){B({currentMd:c.getSession().getValue()}),a&&bh.showMessage(bh.messages.docSavedLocal)}function O(){k.autosave.enabled?e=setInterval(function(){N()},k.autosave.interval):clearInterval(e)}function P(){localStorage.clear(),k.autosave.enabled=!1,delete localStorage.profile,window.location.reload()}function Q(){var a=r.find("option:selected").val();if(a===k.theme)return;R(a,function(){bh.showMessage(bh.messages.profileUpdated)})}function R(a,b){var d=a.split("/").pop();y("/js/theme-"+d+".js",function(){c.setTheme(a),b&&b(),S(d),B({theme:a})})}function S(a){document.body.style.backgroundColor=x[a]}function T(){var a=c.getSession().getValue(),b=d.makeHtml(a);s.html("").html(b)}function U(a){typeof a=="string"?f=a:f=H(),B({current_filename:f})}function V(){function b(a,b){}function d(a,b,c){var d=JSON.parse(c.responseText);document.getElementById("downloader").src="/files/md/"+d.data}function e(a,b,c){alert("Roh-roh. Something went wrong. :(")}function f(a,b){}var a=c.getSession().getValue(),g={type:"POST",data:"unmd="+encodeURIComponent(a),dataType:"json",url:"/factory/fetch_markdown",beforeSend:b,error:e,success:d,complete:f};$.ajax(g)}function W(){function b(a,b){}function d(a,b,c){var d=JSON.parse(c.responseText);document.getElementById("downloader").src="/files/html/"+d.data}function e(a,b,c){alert("Roh-roh. Something went wrong. :(")}function f(a,b){}var a=c.getSession().getValue(),g={type:"POST",data:"unmd="+encodeURIComponent(a),dataType:"json",url:"/factory/fetch_html",beforeSend:b,error:e,success:d,complete:f};$.ajax(g)}function X(){alert("Sad Panda - No localStorage for you!")}function Y(){$(".modal-header h3").text("What's the deal with Dillinger?");var a="<p>Dillinger is an online cloud-enabled, HTML5, buzzword-filled Markdown editor.</p><p>Dillinger was designed and developed by <a href='http://twitter.com/joemccann'>@joemccann</a> because he needed a decent Markdown editor.</p><p>Dillinger is a 100% open source project so <a href='https://github.com/joemccann/dillinger'>fork the code</a> and contribute!</p><p>Follow Dillinger on Twitter at <a href='http://twitter.com/dillingerapp'>@dillingerapp</a></p>";$(".modal-body").html(a),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0})}function Z(){w.bind($.support.transitionEnd,function(a){if($("nav").hasClass("slide_in"))return;u.text(i?"Show Navigation":"Hide Navigation"),q.slideToggle(50,function(){p[i?"addClass":"removeClass"]("opacity_thirty").animate({right:i?"-40px":g},200),i=!i})})}function _(){w.hasClass("slide_in")?w.removeClass("slide_in").addClass("slide_out"):w.removeClass("slide_out").addClass("slide_in")}function ba(){s.css("backgroundImage",k.showPaper?'url("")':'url("'+j+'")'),B({showPaper:!k.showPaper}),bh.showMessage(bh.messages.profileUpdated)}function bb(){t.text(k.autosave.enabled?"Enable Autosave":"Disable Autosave"),B({autosave:{enabled:!k.autosave.enabled}}),O()}function bc(){$('#filename > p[contenteditable="true"]').bind("keyup",U)}function bd(){$("#editor").bind("keyup",T)}function be(){var a={over:function(){if($("nav").hasClass("slide_in"))return;p.removeClass("opacity_thirty").animate({right:g},200)},timeout:300,out:function(){if($("nav").hasClass("slide_in"))return;q.is(":visible")&&q.slideToggle(50),p.animate({right:"-40px"},200).addClass("opacity_thirty")}};$(".core_inner").on("click",function(){q.slideToggle(50)}),p.hoverIntent(a),$("#clear").on("click",function(){return M(),!1}),$("#save").on("click",function(){return k.current_filename=k.current_filename||"/Dillinger/"+G("md"),bj.putMarkdownFile(),N(),!1}),$("#paper").on("click",function(){return ba(),!1}),r.on("change",function(){return Q(),!1}),u.on("click",function(){return _(),!1}),$("#reset").on("click",function(){return P(),!1}),t.on("click",function(){return bb(),!1}),v.on("click",function(){return bi.fetchRepos(),!1}),$("#dropbox_profile").on("click",function(){return bj.searchDropbox(),!1}),$("#export_md").on("click",function(){return V(),!1}),$("#export_html").on("click",function(){return W(),!1}),$("#about").on("click",function(){return Y(),!1})}function bf(){key("command+s, ctrl+s",function(a){N(!0),a.preventDefault()});var a={name:"save",bindKey:{mac:"Command-S",win:"Ctrl-S"},exec:function(){N()}}}function bg(){$(document).on("click",".repo",function(){var a=$(this).parent("li").attr("data-repo-name");return bi.isRepoPrivate=$(this).parent("li").attr("data-repo-private")==="true"?!0:!1,bi.fetchBranches(a),!1}).on("click",".branch",function(){var a=$(this).parent("li").attr("data-repo-name"),b=$(this).parent("li").attr("data-commit-sha");return bi.currentBranch=$(this).text(),bi.fetchTreeFiles(a,b),!1}).on("click",".tree_file",function(){var a=$(this).parent("li").attr("data-tree-file");return bi.fetchMarkdownFile(a),!1}).on("click",".dropbox_file",function(){var a=$(this).parent("li").attr("data-file-path");return k.current_filename=a.split("/").pop().replace(".md",""),bj.setFilePath(a),bj.fetchMarkdownFile(a),!1})}var c,d,e,g,h,i=!0,j="/img/notebook_paper_200x200.gif",k={theme:"ace/theme/clouds_midnight",showPaper:!0,currentMd:"",autosave:{enabled:!0,interval:3e3},current_filename:"Untitled Document",dropbox:{filepath:"/Dillinger/"}},l="dillinger",m=document.createElement(l),n=m.style,o="Webkit Moz O ms Khtml".split(" "),p=$(".cont"),q=$(".core_menu"),r=$("#theme"),s=$("#preview"),t=$("#autosave"),u=$("#toggleNav"),v=$("#github_profile"),w=$("nav"),x={clouds:"#7AC9E3",clouds_midnight:"#5F9EA0",cobalt:"#4d586b",crimson_editor:"#ffffff",dawn:"#DADCAD",eclipse:"#6C7B8A",idle_fingers:"#DEB887",kr_theme:"#434343",merbivore:"#3E353E",merbivore_soft:"#565156",mono_industrial:"#C0C0C0",monokai:"#F5DEB3",pastel_on_dark:"#676565","solarized-dark":"#0E4B5A",solarized_light:"#dfcb96",textmate:"#fff",tomorrow:"#0e9211",tomorrow_night:"#333536",tomorrow_night_blue:"#3a4150",tomorrow_night_bright:"#3A3A3A",tomorrow_night_eighties:"#474646",twilight:"#534746",vibrant_ink:"#363636"},bh=function(){var a=$("#notify");return{messages:{profileUpdated:"Profile updated",profileCleared:"Profile cleared",docSavedLocal:"Document saved locally",docSavedServer:"Document saved on our server",docSavedDropbox:"Document saved on dropbox",dropboxImportNeeded:"Please import a file from dropbox first."},showMessage:function(b,c){a.text("").stop().text(b).slideDown(250,function(){a.delay(c||1e3).slideUp(250)})}}}(),bi=function(){function d(c,d){return a=c.url.toLowerCase(),b=d.url.toLowerCase(),a===b?0:isNaN(c)||isNaN(d)?a>b?1:-1:c-d}function e(a){return/(\.md)|(\.markdown)/i.test(a)}function f(a,b){var c=[],d="https://raw.github.com",f="/";return b.forEach(function(b){if(e(b.path)){var g;bi.isRepoPrivate?g=b.url:g=d+f+h+f+a+f+bi.currentBranch+f+b.path;var i={link:g,path:b.path,sha:b.sha};c.push(i)}}),c}function g(a){var b="<ul>";return a.sort(d),a.forEach(function(a){var c=a.url.split("/").pop();b+='<li data-repo-name="'+c+'" data-repo-private="'+a.private+'"><a class="repo" href="#">'+c+"</a></li>"}),b+="</ul>",$(".modal-header h3").text("Your Github Repos"),$(".modal-body").html(b),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0}),!1}function i(a,b){var c="";b.forEach(function(b){var d=b.name,e=b.commit.sha;c+='<li data-repo-name="'+a+'" data-commit-sha="'+e+'"><a class="branch" href="#">'+d+"</a></li>"}),$(".modal-header h3").text(a),$(".modal-body").find("ul").find("li").remove().end().append(c)}function j(a,b){var c=f(a,b),d="";c.forEach(function(a){d+=bi.isRepoPrivate?'<li data-tree-file-sha="'+a.sha+'" data-tree-file="'+a.link+'" class="private_repo"><a class="tree_file" href="#">'+a.path+"</a></li>":'<li data-tree-file="'+a.link+'"><a class="tree_file" href="#">'+a.path+"</a></li>"}),$(".modal-header h3").text(a),$(".modal-body").find("ul").find("li").remove().end().append(d)}return{currentBranch:"",isRepoPrivate:!1,fetchRepos:function(){function a(a,b){bh.showMessage("Fetching Repos...")}function b(a,b,c){c=JSON.parse(c.responseText),c.length?g(c):bh.showMessage("No repos available!")}function c(a,b,c){alert("Roh-roh. Something went wrong. :(")}function d(a,b){}var e={type:"POST",dataType:"text",url:"/github/repo/fetch_all",beforeSend:a,error:c,success:b,complete:d};$.ajax(e)},fetchBranches:function(a){function b(b,c){bh.showMessage("Fetching Branches for Repo "+a)}function c(b,c,d){d=JSON.parse(d.responseText),d.length?i(a,d):(bh.showMessage("No branches available!"),$("#modal-generic").modal("hide"))}function d(a,b,c){alert("Roh-roh. Something went wrong. :(")}function e(a,b){}var f={type:"POST",dataType:"json",data:"repo="+a,url:"/github/repo/fetch_branches",beforeSend:b,error:d,success:c,complete:e};$.ajax(f)},fetchTreeFiles:function(a,b){function c(b,c){bh.showMessage("Fetching Tree for Repo "+a)}function d(b,c,d){d=JSON.parse(d.responseText),d.tree.length?j(a,d.tree):(bh.showMessage("No tree files available!"),$("#modal-generic").modal("hide"))}function e(a,b,c){alert("Roh-roh. Something went wrong. :(")}function f(a,b){}var g={type:"POST",dataType:"json",data:"repo="+a+"&sha="+b,url:"/github/repo/fetch_tree_files",beforeSend:c,error:e,success:d,complete:f};$.ajax(g)},fetchMarkdownFile:function(a){function b(a,b){}function d(a,b,d){d=JSON.parse(d.responseText),d.error?(bh.showMessage("No markdown for you!"),$("#modal-generic").modal("hide")):($("#modal-generic").modal("hide"),c.getSession().setValue(d.data),T())}function e(a,b,c){alert("Roh-roh. Something went wrong. :(")}function f(a,b){}var g={type:"POST",dataType:"json",data:"mdFile="+a,url:"/github/repo/fetch_markdown_file",beforeSend:b,error:e,success:d,complete:f};$.ajax(g)}}}(),bj=function(){function d(c,d){return a=c.path.toLowerCase(),b=d.path.toLowerCase(),a===b?0:isNaN(c)||isNaN(d)?a>b?1:-1:c-d}function e(a){var b="<ul>";return a.sort(d),a.forEach(function(a){b+='<li data-file-path="'+a.path+'"><a class="dropbox_file" href="#">'+a.path+"</a></li>"}),b+="</ul>",$(".modal-header h3").text("Your Dropbox Files"),$(".modal-body").html(b),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0}),!1}function f(a){return encodeURIComponent(a.split("/").pop())}function g(a){var b=a.split("/").pop();return a.replace(b,"")}return{fetchAccountInfo:function(){function a(a,b){bh.showMessage("Fetching User Info from Dropbox")}function b(a,b,c){var d=JSON.parse(c.responseText);bh.showMessage("Sup "+d.display_name)}function c(a,b,c){alert("Roh-roh. Something went wrong. :(")}function d(a,b){}var e={type:"GET",dataType:"json",url:"/dropbox/account/info",beforeSend:a,error:c,success:b,complete:d};$.ajax(e)},fetchMetadata:function(){function a(a,b){bh.showMessage("Fetching Metadata")}function b(a,b,c){var d=JSON.parse(c.responseText)}function c(a,b,c){alert("Roh-roh. Something went wrong. :(")}function d(a,b){}var e={type:"GET",dataType:"json",url:"/dropbox/metadata",beforeSend:a,error:c,success:b,complete:d};$.ajax(e)},searchDropbox:function(){function a(a,b){bh.showMessage("Searching for .md Files")}function b(a,b,c){var d=JSON.parse(c.responseText);if(d.hasOwnProperty("statusCode")&&d.statusCode===401){var b=JSON.parse(d.data);bh.showMessage("Error! "+b.error,1e3),setTimeout(function(){bh.showMessage("Reloading!"),window.location.reload()},1250);return}d.length?e(d):bh.showMessage("No .md files found!")}function c(a,b,c){alert("Roh-roh. Something went wrong. :(")}function d(a,b){}var f={type:"GET",dataType:"json",url:"/dropbox/search",beforeSend:a,error:c,success:b,complete:d};$.ajax(f)},fetchMarkdownFile:function(a){function b(a,b){}function d(a,b,d){d=JSON.parse(d.responseText);if(d.statusCode===404){var e=JSON.parse(d.data);bh.showMessage(e.error)}else $("#modal-generic").modal("hide"),U(k.current_filename),I(),c.getSession().setValue(d.data),T()}function e(a,b,c){alert("Roh-roh. Something went wrong. :(")}function h(a,b){}var i=f(a),j=g(a);a=j+i;var l={type:"POST",dataType:"json",data:"mdFile="+a,url:"/dropbox/files/get",beforeSend:b,error:e,success:d,complete:h};$.ajax(l)},setFilePath:function(a){a=g(a),B({dropbox:{filepath:a}})},putMarkdownFile:function(){function a(a,b){}function b(a,b,c){c=JSON.parse(c.responseText);if(c.statusCode>=204){var d=JSON.parse(c.data);bh.showMessage(d.error,5e3)}else $("#modal-generic").modal("hide"),bh.showMessage(bh.messages.docSavedDropbox)}function d(a,b,c){alert("Roh-roh. Something went wrong. :(")}function e(a,b){}var f=encodeURIComponent(c.getSession().getValue()),g="pathToMdFile="+k.dropbox.filepath+encodeURIComponent(k.current_filename)+".md"+"&fileContents="+f,h={type:"POST",dataType:"json",data:g,url:"/dropbox/files/put",beforeSend:a,error:d,success:b,complete:e};$.ajax(h)}}}();J()}),window.onload=function(){var a=$("#loading");a.bind($.support.transitionEnd,function(b){$("#main").removeClass("bye"),a.remove()}).addClass("fade_slow")}
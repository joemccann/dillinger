
function editorType(){return profile.editors[profile.editing]}function arrayToRegExp(e){return new RegExp("("+e.map(function(e){return e.replace(".","\\.")}).join("|")+")$","i")}function _isFileExt(e){return arrayToRegExp(editorType().fileExts).test(e)}function asyncLoad(e,t){(function(n,r){var i=n.createElement(r),s=n.getElementsByTagName(r)[0];i.async=1,i.src=e,s.parentNode.insertBefore(i,s),i.onload=function(){t&&t()}})(document,"script")}function hasLocalStorage(){var e;try{localStorage.getItem&&(e=localStorage)}catch(t){}return e}function getUserProfile(){var e;try{e=JSON.parse(localStorage.profile),e=$.extend(!0,profile,e)}catch(t){e=profile}profile=e}function updateUserProfile(e){localStorage.clear(),localStorage.profile=JSON.stringify($.extend(!0,profile,e))}function prefixed(e){return testPropsAll(e,"pfx")}function testProps(e,t){for(var n in e)if(dillingerStyle[e[n]]!==undefined)return t==="pfx"?e[n]:!0;return!1}function testPropsAll(e,t){var n=e.charAt(0).toUpperCase()+e.substr(1),r=(e+" "+domPrefixes.join(n+" ")+n).split(" ");return testProps(r,t)}function normalizeTransitionEnd(){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"msTransitionEnd",transition:"transitionend"};return e[prefixed("transition")]}function generateRandomFilename(e){return"dillinger_"+(new Date).toISOString().replace(/[\.:-]/g,"_")+"."+e}function getCurrentFilenameFromField(){return $('#filename > span[contenteditable="true"]').text()}function setCurrentFilenameField(e){$('#filename > span[contenteditable="true"]').text(e||profile.current_filename||"Untitled Document")}function getTextInElement(e){if(e.nodeType===3)return e.data;var t="";if(e=e.firstChild)do t+=getTextInElement(e);while(e=e.nextSibling);return t}function countWords(e){var t=e.replace(/W+/g," ").match(/\S+/g);return t&&t.length||0}function init(){hasLocalStorage()?($.support.transitionEnd=normalizeTransitionEnd(),getUserProfile(),initAce(),initEditorType(),initUi(),marked.setOptions({gfm:!0,tables:!0,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!1,langPrefix:"lang-",highlight:function(e){return hljs.highlightAuto(e).value}}),bindPreview(),bindNav(),bindKeyboard(),bindDelegation(),bindFilenameField(),bindWordCountEvents(),autoSave(),initWordCount(),refreshWordCount()):sadPanda()}function initAce(){editor=ace.edit("editor")}function initEditorType(){if($("#editor-dropdown li").length===0){var e="",t=Object.keys(profile.editors);t.forEach(function(t){var n=profile.editors[t];e+='<li><a href="#" data-value="'+t+'">'+n.name+"</a></li>"}),$("#editor-dropdown").find("li").remove().end().append(e)}editorType().type.substring(0,8)=="markdown"?(marked.setOptions({gfm:editorType().type==="markdown-gfm"?!0:!1,tables:!0,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1,langPrefix:"lang-",highlight:function(e,t,n){return hljs.getLanguage(t)&&(e=hljs.highlight(t,e).value),e}}),converter=marked,editor.getSession().setMode("ace/mode/markdown")):(converter=function(e){var t=document.createElement("div");return t.innerHTML=e,t.innerHTML.replace(/(?:^\s*|\s*$)/g,"")},editor.getSession().setMode("ace/mode/html")),$("#editor-selector a.dropdown-toggle").text(editorType().name).append("<b class='caret'></b>")}function initUi(){fetchTheme(profile.theme,function(){$theme.find('li > a[data-value="'+profile.theme+'"]').addClass("selected"),editor.getSession().setUseWrapMode(!0),editor.setShowPrintMargin(!1),editor.getSession().setValue(profile.currentFile||editor.getSession().getValue()),previewMd()}),$preview.css("backgroundImage",profile.showPaper?'url("'+paperImgPath+'")':'url("")'),$autosave.html(profile.autosave.enabled?'<i class="glyphicon glyphicon-ok"></i>&nbsp;Autosave is Enabled':'<i class="glyphicon glyphicon-remove"></i>&nbsp;Autosave is Disabled'),$wordcount.html(profile.wordcount?'<i class="glyphicon glyphicon-ok"></i>&nbsp;Word Count is Enabled':'<i class="glyphicon glyphicon-remove"></i>&nbsp;Word Count is Disabled'),githubUser=$("#import_github").attr("data-github-username"),githubUser&&Notifier.showMessage("What's Up "+githubUser,1e3),setCurrentFilenameField(),$(".dropdown-toggle").dropdown()}function clearSelection(){editor.getSession().setValue(""),previewMd()}function saveFile(e){updateUserProfile({currentFile:editor.getSession().getValue()}),typeof e=="object"&&e.manual===!0&&Notifier.showMessage(Notifier.messages.docSavedLocal)}function autoSave(){profile.autosave.enabled?autoInterval=setInterval(function(){saveFile(),LocalFiles.saveFile({show:!1})},profile.autosave.interval):clearInterval(autoInterval)}function resetProfile(){localStorage.clear(),profile.autosave.enabled=!1,delete localStorage.profile,window.location.reload()}function changeTheme(e){var t=$(e.target);if(t.attr("data-value")===profile.theme)return;$theme.find("li > a.selected").removeClass("selected"),t.addClass("selected");var n=t.attr("data-value");$(e.target).blur(),fetchTheme(n,function(){Notifier.showMessage(Notifier.messages.profileUpdated)})}function fetchTheme(e,t){var n=e.split("/").pop();asyncLoad("/js/theme-"+n+".js",function(){editor.setTheme(e),t&&t(),updateBg(n),updateUserProfile({theme:e})})}function updateBg(e){document.body.style.backgroundColor=bgColors[e]}function previewMd(){var e=editor.getSession().getValue(),t=converter(e);editorType().type==="html"?($preview.html(""),$("<iframe>").appendTo($preview).contents().find("body").html(t)):$preview.html("").html(t),refreshWordCount()}function refreshWordCount(e){var t="Words: ";e!==undefined&&(t+=e+" of "),profile.wordcount&&$wordcounter.text(t+countWords(getTextInElement($preview[0])))}function updateFilename(e){var t;typeof e=="string"?t=e:t=getCurrentFilenameFromField(),updateUserProfile({current_filename:t})}function fetchMarkdownFile(){function t(e,t,n){e=t=null;var r=JSON.parse(n.responseText);document.getElementById("downloader").src="/files/md/"+r.data}function n(){alert("Roh-roh. Something went wrong. :(")}var e=editor.getSession().getValue(),r={type:"POST",data:"name="+encodeURIComponent(getCurrentFilenameFromField())+"&unmd="+encodeURIComponent(e),dataType:"json",url:"/factory/fetch_markdown",error:n,success:t};$.ajax(r)}function fetchHtmlFile(e){function n(e,t,n){var r=JSON.parse(n.responseText);document.getElementById("downloader").src="/files/html/"+r.data}function r(){alert("Roh-roh. Something went wrong. :(")}var t=editor.getSession().getValue(),i={type:"POST",data:"name="+encodeURIComponent(getCurrentFilenameFromField())+"&unmd="+encodeURIComponent(t)+(e?"&formatting=true":""),dataType:"json",url:"/factory/fetch_html",error:r,success:n};$.ajax(i)}function fetchPdfFile(){function t(e,t,n){var r=JSON.parse(n.responseText);document.getElementById("downloader").src="/files/pdf/"+r.data}function n(){alert("Roh-roh. Something went wrong. :(")}var e=editor.getSession().getValue(),r={type:"POST",data:"name="+encodeURIComponent(getCurrentFilenameFromField())+"&unmd="+encodeURIComponent(e),dataType:"json",url:"/factory/fetch_pdf",error:n,success:t};$.ajax(r)}function showHtml(){function t(e,t,n){var r=JSON.parse(n.responseText);return $textarea='<textarea id="modalBodyText">'+r.data+"</textarea>",$(".modal-header h3").text("Show HTML: "+getCurrentFilenameFromField()),$(".modal-body").css("height","80%").html($textarea),$("#modal-generic").on("shown.bs.modal",function(e){$("#modalBodyText").focus().select()}).modal({keyboard:!0,backdrop:!0,show:!0}),!1}function n(){alert("Roh-roh. Something went wrong. :(")}var e=editor.getSession().getValue(),r={type:"POST",data:"name="+encodeURIComponent(getCurrentFilenameFromField())+"&unmd="+encodeURIComponent(e),dataType:"json",url:"/factory/fetch_html_direct",error:n,success:t};$.ajax(r)}function sadPanda(){alert("Sad Panda - No localStorage for you!")}function showAboutInfo(){$(".modal-header h3").text("What's the deal with Dillinger?");var e="<p>Dillinger is an online cloud-enabled, HTML5, buzzword-filled Markdown editor.</p><p>Dillinger was designed and developed by <a href='http://twitter.com/joemccann'>@joemccann</a> because he needed a decent Markdown editor.</p><p>Dillinger is a 100% open source project so <a href='https://github.com/joemccann/dillinger'>fork the code</a> and contribute!</p><p>Follow Dillinger on Twitter at <a href='http://twitter.com/dillingerapp'>@dillingerapp</a></p><p>Follow Joe McCann on Twitter at <a href='http://twitter.com/joemccann'>@joemccann</a></p>";$(".modal-body").html(e),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0})}function showPreferences(){$(".modal-header h3").text("Preferences");var e='<div><ul><li><a href="#" id="paper">Toggle Paper</a></li><li><a href="#" id="reset_pref">Reset Profile</a></li></ul></div>';$(".modal-body").html(e),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0})}function togglePaper(){$preview.css("backgroundImage",profile.showPaper?'url("")':'url("'+paperImgPath+'")'),updateUserProfile({showPaper:!profile.showPaper}),Notifier.showMessage(Notifier.messages.profileUpdated)}function toggleAutoSave(){$autosave.html(profile.autosave.enabled?'<i class="glyphicon glyphicon-remove"></i>&nbsp;Autosave is Disabled':'<i class="glyphicon glyphicon-ok"></i>&nbsp;Autosave is Enabled'),updateUserProfile({autosave:{enabled:!profile.autosave.enabled}}),autoSave()}function initWordCount(){profile.wordcount?($wordcounter.removeClass("hidden"),$filename.addClass("show-word-count-filename-adjust")):($wordcounter.addClass("hidden"),$filename.removeClass("show-word-count-filename-adjust"))}function toggleWordCount(){$wordcount.html(profile.wordcount?'<i class="glyphicon glyphicon-remove"></i>&nbsp;Word Count is Disabled':'<i class="glyphicon glyphicon-ok"></i>&nbsp;Word Count is Enabled'),updateUserProfile({wordcount:!profile.wordcount}),initWordCount()}function bindFilenameField(){$('#filename > span[contenteditable="true"]').bind("keyup",updateFilename)}function bindWordCountEvents(){$preview.bind("mouseup",checkForSelection)}function checkForSelection(){if(profile.wordcount){var e=window.getSelection().toString();e!==""?refreshWordCount(countWords(e)):refreshWordCount()}}function bindPreview(){$("#editor").bind("keyup",previewMd)}function bindNav(){$theme.find("li > a").bind("click",function(e){return changeTheme(e),!1}),$("#clear").on("click",function(){return clearSelection(),!1}),$(".modal-body").on("click","#paper",function(){return togglePaper(),!1}).on("click","#reset_pref",function(){return resetProfile(),!1}),$("#reset").on("click",function(){return resetProfile(),!1}),$("#autosave").on("click",function(){return toggleAutoSave(),!1}),$("#wordcount").on("click",function(){return toggleWordCount(),!1}),$("#export_md").on("click",function(){return fetchMarkdownFile(),$(".dropdown").removeClass("open"),!1}),$("#export_html").on("click",function(){return fetchHtmlFile(),$(".dropdown").removeClass("open"),!1}),$("#export_html_formatted").on("click",function(){return fetchHtmlFile(!0),$(".dropdown").removeClass("open"),!1}),$("#export_pdf").on("click",function(){return fetchPdfFile(),$(".dropdown").removeClass("open"),!1}),$("#show_html").on("click",function(){return showHtml(),$(".dropdown").removeClass("open"),!1}),$("#preferences").on("click",function(){return showPreferences(),!1}),$("#about").on("click",function(){return showAboutInfo(),!1}),$("#cheat").on("click",function(){return window.open("https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet","_blank"),!1}),$("#new_local_file").on("click",function(){return $(".dropdown").removeClass("open"),LocalFiles.newFile(),!1}),$("#import_local_file").on("click",function(){return $(".dropdown").removeClass("open"),LocalFiles.search(),!1}),$("#save_local_file").on("click",function(){return $(".dropdown").removeClass("open"),LocalFiles.saveFile(),!1}),$("#editor-dropdown").on("click","li > a",function(){var e=$(this).attr("data-value");profile.editors[e]?(profile.editing=e,initEditorType(),previewMd()):Notifier.showMessage("Sorry, "+e+" isn't supported")}),Plugins.forEach(function(e){e.bindNav&&e.bindNav()})}function bindKeyboard(){key("command+s, ctrl+s",function(e){saveFile({manual:!0}),e.preventDefault()}),key("enter",function(e){e.target.parentNode&&e.target.parentNode.id==="filename"&&e.preventDefault()});var e={name:"save",bindKey:{mac:"Command-S",win:"Ctrl-S"},exec:function(){saveFile(),LocalFiles.saveFile()}},t={name:"filenamer",bindKey:{mac:"Command-Shift-M",win:"Ctrl-Shift-M"},exec:function(){var e=JSON.parse(localStorage.profile);alert(e.current_filename.replace(/\s/g,"-").toLowerCase())}};editor.commands.addCommand(e),editor.commands.addCommand(t)}function bindDelegation(){$(document).on("click",".org",function(){var e=$(this).parent("li").attr("data-org-name");return e!==Github.currentOwner?Github.currentPage=1:Github.currentPage=Github.currentPage||1,Github.currentOwner=e,Github.fetchRepos(Github.currentOwner),!1}).on("click",".repos.pager .next",function(){return Github.fetchRepos(Github.currentOwner,"next"),!1}).on("click",".repos.pager .previous",function(){return Github.currentPage<=1?!1:(Github.fetchRepos(Github.currentOwner,"prev"),!1)}).on("click",".repo",function(){var e=Github.currentOwner,t=$(this).parent("li").attr("data-repo-name");return Github.isRepoPrivate=$(this).parent("li").attr("data-repo-private")==="true"?!0:!1,Github.fetchBranches(e,t),!1}).on("click",".branch",function(){var e=Github.currentOwner,t=$(this).parent("li").attr("data-repo-name"),n=$(this).parent("li").attr("data-commit-sha"),r=$(this).text();return Github.currentBranch=r,Github.fetchTreeFiles(e,t,r,n),!1}).on("click",".tree_file",function(){var e=$(this).parent("li").attr("data-tree-file"),t=$(this).parent("li").attr("data-name"),n=$(this).parent("li").attr("data-tree-file-sha"),r=$(this).parent("li").attr("data-owner"),i=$(this).parent("li").attr("data-branch"),s=$(this).parent("li").attr("data-repo");return Github.fetchMarkdownFile(e,{name:t,sha:n,branch:i,owner:r,repo:s}),!1}).on("click",".github_org",function(){delete Github.currentPage,Github.fetchOrgs()}).on("click",".github_repo",function(){Github.fetchRepos(Github.currentOwner)}).on("click",".dropbox_file",function(){var e=$(this).parent("li").attr("data-file-path");return profile.current_filename=e.split("/").pop().replace(arrayToRegExp(editorType().fileExts),""),Dropbox.setFilePath(e),Dropbox.fetchMarkdownFile(e),!1}).on("click",".googledrive_file",function(){var e=$(this).parent("li").attr("data-file-id");return profile.current_filename=$(this).html(),GoogleDrive.fileId=e,GoogleDrive.get(),!1}).on("click",".local_file",function(){var e=$(this).parent("li").attr("data-file-name");return profile.current_filename=$(this).html(),LocalFiles.loadFile(e),!1}).on("click",".delete_local_file",function(){var e=$(this).parent("li"),t=e.attr("data-file-name");return LocalFiles.deleteFile(t),e.remove(),!1}),"draggable"in document.createElement("span")&&$("#editor").on("dragover",function(e){e.preventDefault(),e.stopPropagation()}).on("drop",function(e){e.preventDefault(),e.stopPropagation();var t=e.originalEvent,n=t.target.files||t.dataTransfer.files,r=new FileReader,i=0,s,o;do s=n[i++];while(s&&s.type.substr(0,4)!=="text"&&!_isFileExt(s.name));if(!s)return;r.onload=function(e){editor.getSession().setValue(e.target.result),previewMd()},r.readAsText(s)})}function getScrollHeight(e){return e[0].scrollHeight!==undefined?e[0].scrollHeight:e.find("html")[0].scrollHeight!==undefined&&e.find("html")[0].scrollHeight!==0?e.find("html")[0].scrollHeight:e.find("body")[0].scrollHeight}function syncPreview(){var e=window.ace.edit("editor"),t=$("#preview"),n=e.getSession().getLength(),r=getScrollHeight(t),i=e.getFirstVisibleRow()/n;t.scrollTop(i*r)}var editor,converter,autoInterval,githubUser,paperImgPath="/img/notebook_paper_200x200.gif",profile={theme:"ace/theme/idle_fingers",showPaper:!1,currentFile:"",autosave:{enabled:!0,interval:3e3},wordcount:!0,current_filename:"Untitled Document",github:{current_uri:"",opts:{}},dropbox:{filepath:"/Dillinger/"},local_files:{"Untitled Document":""},editing:"markdown-gfm",editors:{"markdown-gfm":{type:"markdown-gfm",name:"Github Markdown",fileExts:[".md",".markdown",".mdown"]},markdown:{type:"markdown",name:"Markdown",fileExts:[".md",".markdown",".mdown"]},html:{type:"html",name:"HTML",fileExts:[".html",".htm"]}}},dillinger="dillinger",dillingerElem=document.createElement(dillinger),dillingerStyle=dillingerElem.style,domPrefixes="Webkit Moz O ms Khtml".split(" "),$theme=$("#theme-list"),$preview=$("#preview"),$autosave=$("#autosave"),$wordcount=$("#wordcount"),$wordcounter=$("#wordcounter"),$filename=$("#filename"),bgColors={chrome:"#bbbbbb",clouds:"#7AC9E3",clouds_midnight:"#5F9EA0",cobalt:"#4d586b",crimson_editor:"#ffffff",dawn:"#DADCAD",eclipse:"#6C7B8A",idle_fingers:"#DEB887",kr_theme:"#434343",merbivore:"#3E353E",merbivore_soft:"#565156",mono_industrial:"#C0C0C0",monokai:"#F5DEB3",pastel_on_dark:"#676565","solarized-dark":"#0E4B5A",solarized_light:"#dfcb96",textmate:"#fff",tomorrow:"#0e9211",tomorrow_night:"#333536",tomorrow_night_blue:"#3a4150",tomorrow_night_bright:"#3A3A3A",tomorrow_night_eighties:"#474646",twilight:"#534746",vibrant_ink:"#363636"},LocalFiles=function(){function e(e,t){var n=e.toLowerCase(),r=t.toLowerCase();return n===r?0:isNaN(e)||isNaN(t)?n>r?1:-1:e-t}function t(t){var n="<ul>";return t.sort(e),t.forEach(function(e){n+='<li data-file-name="'+e+'"><a class="delete_local_file"><i class="glyphicon glyphicon-remove"></i></a><a class="local_file" href="#">'+e+"</a></li>"}),n+="</ul>",$(".modal-header h3").text("Your Local Files"),$(".modal-body").html(n),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0}),!1}return{newFile:function(){updateFilename(""),setCurrentFilenameField(),editor.getSession().setValue("")},search:function(){var e=Object.keys(profile.local_files);e.length<1?Notifier.showMessage("No files saved locally"):t(e)},loadFile:function(e){$("#modal-generic").modal("hide"),updateFilename(e),setCurrentFilenameField(),editor.getSession().setValue(profile.local_files[e]),previewMd(),Github.clear()},saveFile:function(e){var t=getCurrentFilenameFromField(),n=editor.getSession().getValue(),r={local_files:{}};r.local_files[t]=n,updateUserProfile(r),(typeof e!="object"||e.show!==!1)&&Notifier.showMessage(Notifier.messages.docSavedLocal)},deleteFile:function(e){var t=profile.local_files;delete profile.local_files[e],updateUserProfile(),Notifier.showMessage(Notifier.messages.docDeletedLocal)}}}();window.foo=LocalFiles.saveFile,init(),window.onload=function(){var e=$("#loading");$.support.transition?$("body").on($.support.transition.end,"#loading",function(){$("#main").removeClass("bye"),e.remove()}).find("#loading").addClass("fade_slow"):($("#main").removeClass("bye"),e.remove()),window.ace.edit("editor").session.on("changeScrollTop",syncPreview),window.ace.edit("editor").session.selection.on("changeCursor",syncPreview)}
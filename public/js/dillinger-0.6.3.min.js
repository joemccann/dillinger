
function getScrollHeight(e){return e[0].scrollHeight!==undefined?e[0].scrollHeight:e.find("html")[0].scrollHeight!==undefined&&e.find("html")[0].scrollHeight!==0?e.find("html")[0].scrollHeight:e.find("body")[0].scrollHeight}function syncPreview(){var e=window.ace.edit("editor"),t=$("#preview"),n=e.getSession().getLength(),r=getScrollHeight(t),i=e.getFirstVisibleRow()/n;t.scrollTop(i*r)}$(function(){function y(e,t){(function(n,r){var i=n.createElement(r),s=n.getElementsByTagName(r)[0];i.async=1,i.src=e,s.parentNode.insertBefore(i,s),i.onload=function(){t&&t()}})(document,"script")}function b(){var e;try{localStorage.getItem&&(e=localStorage)}catch(t){}return e}function w(){var e;try{e=JSON.parse(localStorage.profile),e=$.extend(!0,s,e)}catch(t){e=s}s=e}function E(e){localStorage.clear(),localStorage.profile=JSON.stringify($.extend(!0,s,e))}function S(e){return T(e,"pfx")}function x(e,t){for(var n in e)if(a[e[n]]!==undefined)return t==="pfx"?e[n]:!0;return!1}function T(e,t){var n=e.charAt(0).toUpperCase()+e.substr(1),r=(e+" "+f.join(n+" ")+n).split(" ");return x(r,t)}function N(){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"msTransitionEnd",transition:"transitionend"};return e[S("transition")]}function C(e){return"dillinger_"+(new Date).toISOString().replace(/[\.:-]/g,"_")+"."+e}function k(){return $('#filename > span[contenteditable="true"]').text()}function L(e){$('#filename > span[contenteditable="true"]').text(e||s.current_filename||"Untitled Document")}function A(e){if(e.nodeType===3)return e.data;var t="";if(e=e.firstChild)do t+=A(e);while(e=e.nextSibling);return t}function O(e){var t=e.replace(/W+/g," ").match(/\S+/g);return t&&t.length||0}function M(){b()?($.support.transitionEnd=N(),w(),_(),D(),marked.setOptions({gfm:!0,tables:!0,pedantic:!1,sanitize:!1,smartLists:!0,smartypants:!1,langPrefix:"lang-"}),t=marked,st(),ot(),ut(),at(),nt(),rt(),B(),et(),U()):K()}function _(){e=ace.edit("editor")}function D(){I(s.theme,function(){l.find('li > a[data-value="'+s.theme+'"]').addClass("selected"),e.getSession().setUseWrapMode(!0),e.setShowPrintMargin(!1),e.getSession().setMode("ace/mode/markdown"),e.getSession().setValue(s.currentMd||e.getSession().getValue()),R()}),c.css("backgroundImage",s.showPaper?'url("'+i+'")':'url("")'),h.html(s.autosave.enabled?'<i class="icon-remove"></i>&nbsp;Disable Autosave':'<i class="icon-ok"></i>&nbsp;Enable Autosave'),p.html(s.wordcount?'<i class="icon-ok"></i>&nbsp;Enabled Word Count':'<i class="icon-remove"></i>&nbsp;Disabled Word Count'),r=d.attr("data-github-username"),r&&ft.showMessage("What's Up "+r,1e3),L(),$(".dropdown-toggle").dropdown()}function P(){e.getSession().setValue(""),R()}function H(t){E({currentMd:e.getSession().getValue()}),t&&ft.showMessage(ft.messages.docSavedLocal)}function B(){s.autosave.enabled?n=setInterval(function(){H()},s.autosave.interval):clearInterval(n)}function j(){localStorage.clear(),s.autosave.enabled=!1,delete localStorage.profile,window.location.reload()}function F(e){var t=$(e.target);if(t.attr("data-value")===s.theme)return;l.find("li > a.selected").removeClass("selected"),t.addClass("selected");var n=t.attr("data-value");$(e.target).blur(),I(n,function(){ft.showMessage(ft.messages.profileUpdated)})}function I(t,n){var r=t.split("/").pop();y("/js/theme-"+r+".js",function(){e.setTheme(t),n&&n(),q(r),E({theme:t})})}function q(e){document.body.style.backgroundColor=g[e]}function R(){var n=e.getSession().getValue(),r=t(n);c.html("").html(r),U()}function U(e){var t="Words: ";e!==undefined&&(t+=e+" of "),s.wordcount&&v.text(t+O(A(c[0])))}function z(e){var t;typeof e=="string"?t=e:t=k(),E({current_filename:t})}function W(){function n(e,t,n){e=t=null;var r=JSON.parse(n.responseText);document.getElementById("downloader").src="/files/md/"+r.data}function r(){alert("Roh-roh. Something went wrong. :(")}var t=e.getSession().getValue(),i={type:"POST",data:"unmd="+encodeURIComponent(t),dataType:"json",url:"/factory/fetch_markdown",error:r,success:n};$.ajax(i)}function X(){function n(e,t,n){var r=JSON.parse(n.responseText);document.getElementById("downloader").src="/files/html/"+r.data}function r(){alert("Roh-roh. Something went wrong. :(")}var t=e.getSession().getValue(),i={type:"POST",data:"unmd="+encodeURIComponent(t),dataType:"json",url:"/factory/fetch_html",error:r,success:n};$.ajax(i)}function V(){function n(e,t,n){var r=JSON.parse(n.responseText);document.getElementById("downloader").src="/files/pdf/"+r.data}function r(){alert("Roh-roh. Something went wrong. :(")}var t=e.getSession().getValue(),i={type:"POST",data:"unmd="+encodeURIComponent(t),dataType:"json",url:"/factory/fetch_pdf",error:r,success:n};$.ajax(i)}function J(){function n(e,t,n){var r=JSON.parse(n.responseText),i=$("#modalBodyText");$(i).val(r.data),$("#myModal").on("shown.bs.modal",function(e){$(i).focus().select()}).modal()}function r(){alert("Roh-roh. Something went wrong. :(")}var t=e.getSession().getValue(),i={type:"POST",data:"unmd="+encodeURIComponent(t),dataType:"json",url:"/factory/fetch_html_direct",error:r,success:n};$.ajax(i)}function K(){alert("Sad Panda - No localStorage for you!")}function Q(){$(".modal-header h3").text("What's the deal with Dillinger?");var e="<p>Dillinger is an online cloud-enabled, HTML5, buzzword-filled Markdown editor.</p><p>Dillinger was designed and developed by <a href='http://twitter.com/joemccann'>@joemccann</a> because he needed a decent Markdown editor.</p><p>Dillinger is a 100% open source project so <a href='https://github.com/joemccann/dillinger'>fork the code</a> and contribute!</p><p>Follow Dillinger on Twitter at <a href='http://twitter.com/dillingerapp'>@dillingerapp</a></p><p>Follow Joe McCann on Twitter at <a href='http://twitter.com/joemccann'>@joemccann</a></p>";$(".modal-body").html(e),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0})}function G(){$(".modal-header h3").text("Preferences");var e='<div><ul><li><a href="#" id="paper">Toggle Paper</a></li><li><a href="#" id="reset">Reset Profile</a></li></ul></div>';$(".modal-body").html(e),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0})}function Y(){c.css("backgroundImage",s.showPaper?'url("")':'url("'+i+'")'),E({showPaper:!s.showPaper}),ft.showMessage(ft.messages.profileUpdated)}function Z(){h.html(s.autosave.enabled?'<i class="icon-remove"></i>&nbsp;Disable Autosave':'<i class="icon-ok"></i>&nbsp;Enable Autosave'),E({autosave:{enabled:!s.autosave.enabled}}),B()}function et(){s.wordcount?(v.removeClass("hidden"),m.addClass("show-word-count-filename-adjust")):(v.addClass("hidden"),m.removeClass("show-word-count-filename-adjust"))}function tt(){p.html(s.wordcount?'<i class="icon-remove"></i>&nbsp;Disabled Word Count':'<i class="icon-ok"></i>&nbsp;Enabled Word Count'),E({wordcount:!s.wordcount}),et()}function nt(){$('#filename > span[contenteditable="true"]').bind("keyup",z)}function rt(){c.bind("mouseup",it)}function it(){if(s.wordcount){var e=window.getSelection().toString();e!==""?U(O(e)):U()}}function st(){$("#editor").bind("keyup",R)}function ot(){l.find("li > a").bind("click",function(e){return F(e),!1}),$("#clear").on("click",function(){return P(),!1}),$("#save_dropbox").on("click",function(){return s.current_filename=s.current_filename||"/Dillinger/"+C("md"),ht.putMarkdownFile(),H(),!1}),$("#save_googledrive").on("click",function(){ct.save(),H()}),$(".modal-body").delegate("#paper","click",function(){return Y(),!1}),$("#autosave").on("click",function(){return Z(),!1}),$("#wordcount").on("click",function(){return tt(),!1}),$("#reset").on("click",function(){return j(),!1}),d.on("click",function(){return lt.fetchRepos(),!1}),$("#import_dropbox").on("click",function(){return ht.searchDropbox(),!1}),$("#import_googledrive").on("click",function(){return ct.search(),!1}),$("#export_md").on("click",function(){return W(),$(".dropdown").removeClass("open"),!1}),$("#export_html").on("click",function(){return X(),$(".dropdown").removeClass("open"),!1}),$("#export_pdf").on("click",function(){return V(),$(".dropdown").removeClass("open"),!1}),$("#show_html").on("click",function(){return J(),$(".dropdown").removeClass("open"),!1}),$("#preferences").on("click",function(){return G(),!1}),$("#about").on("click",function(){return Q(),!1}),$("#cheat").on("click",function(){return window.open("https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet","_blank"),!1})}function ut(){key("command+s, ctrl+s",function(e){H(!0),e.preventDefault()});var t={name:"save",bindKey:{mac:"Command-S",win:"Ctrl-S"},exec:function(){H(!0)}},n={name:"filenamer",bindKey:{mac:"Command-Shift-M",win:"Ctrl-Shift-M"},exec:function(){var e=JSON.parse(localStorage.profile);alert(e.current_filename.replace(/\s/g,"-").toLowerCase())}};e.commands.addCommand(t),e.commands.addCommand(n)}function at(){$(document).on("click",".repo",function(){var e=$(this).parent("li").attr("data-repo-name");return lt.isRepoPrivate=$(this).parent("li").attr("data-repo-private")==="true"?!0:!1,lt.fetchBranches(e),!1}).on("click",".branch",function(){var e=$(this).parent("li").attr("data-repo-name"),t=$(this).parent("li").attr("data-commit-sha");return lt.currentBranch=$(this).text(),lt.fetchTreeFiles(e,t),!1}).on("click",".tree_file",function(){var e=$(this).parent("li").attr("data-tree-file");return lt.fetchMarkdownFile(e),!1}).on("click",".dropbox_file",function(){var e=$(this).parent("li").attr("data-file-path");return s.current_filename=e.split("/").pop().replace(".md",""),ht.setFilePath(e),ht.fetchMarkdownFile(e),!1}).on("click",".googledrive_file",function(){var e=$(this).parent("li").attr("data-file-id");return s.current_filename=$(this).html(),ct.fileId=e,ct.get(),!1}),"draggable"in document.createElement("span")&&$("#editor").on("dragover",function(e){e.preventDefault(),e.stopPropagation()}).on("drop",function(t){t.preventDefault(),t.stopPropagation();var n=t.originalEvent,r=n.target.files||n.dataTransfer.files,i=new FileReader,s=0,o,u;do o=r[s++];while(o&&o.type.substr(0,4)!=="text"&&o.name.substr(o.name.length-3)!==".md");if(!o)return;i.onload=function(t){e.getSession().setValue(t.target.result),R()},i.readAsText(o)})}var e,t,n,r,i="/img/notebook_paper_200x200.gif",s={theme:"ace/theme/idle_fingers",showPaper:!1,currentMd:"",autosave:{enabled:!0,interval:3e3},wordcount:!0,current_filename:"Untitled Document",dropbox:{filepath:"/Dillinger/"}},o="dillinger",u=document.createElement(o),a=u.style,f="Webkit Moz O ms Khtml".split(" "),l=$("#theme-list"),c=$("#preview"),h=$("#autosave"),p=$("#wordcount"),d=$("#import_github"),v=$("#wordcounter"),m=$("#filename"),g={chrome:"#bbbbbb",clouds:"#7AC9E3",clouds_midnight:"#5F9EA0",cobalt:"#4d586b",crimson_editor:"#ffffff",dawn:"#DADCAD",eclipse:"#6C7B8A",idle_fingers:"#DEB887",kr_theme:"#434343",merbivore:"#3E353E",merbivore_soft:"#565156",mono_industrial:"#C0C0C0",monokai:"#F5DEB3",pastel_on_dark:"#676565","solarized-dark":"#0E4B5A",solarized_light:"#dfcb96",textmate:"#fff",tomorrow:"#0e9211",tomorrow_night:"#333536",tomorrow_night_blue:"#3a4150",tomorrow_night_bright:"#3A3A3A",tomorrow_night_eighties:"#474646",twilight:"#534746",vibrant_ink:"#363636"},ft=function(){var e=$("#notify");return{messages:{profileUpdated:"Profile updated",profileCleared:"Profile cleared",docSavedLocal:"Document saved locally",docSavedServer:"Document saved on our server",docSavedDropbox:"Document saved on dropbox",dropboxImportNeeded:"Please import a file from dropbox first."},showMessage:function(t,n){e.text("").stop().text(t).slideDown(250,function(){e.delay(n||1e3).slideUp(250)})}}}(),lt=function(){function t(e,t){var n=e.url.toLowerCase(),r=t.url.toLowerCase();return n===r?0:isNaN(e)||isNaN(t)?n>r?1:-1:e-t}function n(e){return/(\.md)|(\.markdown)/i.test(e)}function i(e,t){var i=[],s="https://raw.github.com",o="/";return t.forEach(function(t){if(n(t.path)){var u;lt.isRepoPrivate?u=t.url:u=s+o+r+o+e+o+lt.currentBranch+o+t.path;var a={link:u,path:t.path,sha:t.sha};i.push(a)}}),i}function s(e){var n="<ul>";return e.sort(t),e.forEach(function(e){n+='<li data-repo-name="'+e.name+'" data-repo-private="'+e.private+'"><a class="repo" href="#">'+e.name+"</a></li>"}),n+="</ul>",$(".modal-header h3").text("Your Github Repos"),$(".modal-body").html(n),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0}),!1}function o(e,t){var n="";t.forEach(function(t){var r=t.name,i=t.commit.sha;n+='<li data-repo-name="'+e+'" data-commit-sha="'+i+'"><a class="branch" href="#">'+r+"</a></li>"}),$(".modal-header h3").text(e),$(".modal-body").find("ul").find("li").remove().end().append(n)}function u(e,t){var n=i(e,t),r="";n.forEach(function(e){r+=lt.isRepoPrivate?'<li data-tree-file-sha="'+e.sha+'" data-tree-file="'+e.link+'" class="private_repo"><a class="tree_file" href="#">'+e.path+"</a></li>":'<li data-tree-file="'+e.link+'"><a class="tree_file" href="#">'+e.path+"</a></li>"}),$(".modal-header h3").text(e),$(".modal-body").find("ul").find("li").remove().end().append(r)}return{currentBranch:"",isRepoPrivate:!1,fetchRepos:function(){function e(){ft.showMessage("Fetching Repos...")}function t(e,t,n){e=t=null,n=JSON.parse(n.responseText),n.length?s(n):ft.showMessage("No repos available!")}function n(e,t){alert(e.responseText||"Roh-roh. Something went wrong. :(")}var r={type:"POST",dataType:"text",url:"/import/github/repos",beforeSend:e,error:n,success:t};$.ajax(r)},fetchBranches:function(e){function t(){ft.showMessage("Fetching Branches for Repo "+e)}function n(t,n,r){t=n=null,r=JSON.parse(r.responseText),r.length?o(e,r):(ft.showMessage("No branches available!"),$("#modal-generic").modal("hide"))}function r(){alert("Roh-roh. Something went wrong. :(")}var i={type:"POST",dataType:"json",data:"repo="+e,url:"/import/github/branches",beforeSend:t,error:r,success:n};$.ajax(i)},fetchTreeFiles:function(e,t){function n(){ft.showMessage("Fetching Tree for Repo "+e)}function r(t,n,r){t=n=null,r=JSON.parse(r.responseText),r.tree.length?u(e,r.tree):(ft.showMessage("No tree files available!"),$("#modal-generic").modal("hide"))}function i(){alert("Roh-roh. Something went wrong. :(")}var s={type:"POST",dataType:"json",data:"repo="+e+"&sha="+t,url:"/import/github/tree_files",beforeSend:n,error:i,success:r};$.ajax(s)},fetchMarkdownFile:function(t){function n(n,r,i){n=r=null,i=JSON.parse(i.responseText);if(i.error)ft.showMessage("No markdown for you!"),$("#modal-generic").modal("hide");else{$("#modal-generic").modal("hide"),e.getSession().setValue(i.data);var s=t.split("/").pop();z(s),L(s),R()}}function r(){alert("Roh-roh. Something went wrong. :(")}function i(){$(".dropdown").removeClass("open")}var s={type:"POST",dataType:"json",data:"mdFile="+t,url:"/import/github/file",error:r,success:n,complete:i};$.ajax(s)}}}(),ct=function(){function t(e,t,n){ft.showMessage(n.responseText)}function n(e,n,r){var i=JSON.parse(r.responseText),s="<ul>";if(!Array.isArray(i.items))return t(null,null,{responseText:"No Markdown files found!"});i.items.forEach(function(e){s+='<li data-file-id="'+e.id+'"><a class="googledrive_file" href="#">'+e.title+"</a></li>"}),s+="</ul>",$(".modal-header h3").text("Your Google Drive Files"),$(".modal-body").html(s),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0})}function r(t,n,r){var i=JSON.parse(r.responseText);$("#modal-generic").modal("hide"),e.getSession().setValue(i.content),R()}return{fileId:null,search:function(){$.ajax({dataType:"json",url:"/import/googledrive",beforeSend:function(){ft.showMessage("Searching for .md files")},error:t,success:n})},get:function(){$.ajax({dataType:"json",url:"/fetch/googledrive?fileId="+this.fileId,error:t,success:r})},save:function(){var n=encodeURIComponent(e.getSession().getValue()),r=/(.md|.markdown)$/.test(s.current_filename),i="title="+encodeURIComponent(s.current_filename)+(r?"":".md")+"&content="+n;$.ajax({dataType:"json",type:"post",data:i,url:"/save/googledrive?fileId="+(ct.fileId||""),error:t,success:function(e,t,n){var r=JSON.parse(n.responseText);r.id?(ct.fileId=r.id,ft.showMessage("Document saved on Google Drive")):ft.showMessage("An error occurred!")}})}}}(),ht=function(){function t(e,t){var n=e.path.toLowerCase(),r=t.path.toLowerCase();return n===r?0:isNaN(e)||isNaN(t)?n>r?1:-1:e-t}function n(e){var n="<ul>";return e.sort(t),e.forEach(function(e){n+='<li data-file-path="'+e.path+'"><a class="dropbox_file" href="#">'+e.path+"</a></li>"}),n+="</ul>",$(".modal-header h3").text("Your Dropbox Files"),$(".modal-body").html(n),$("#modal-generic").modal({keyboard:!0,backdrop:!0,show:!0}),!1}function r(e){return encodeURIComponent(e.split("/").pop())}function i(e){var t=e.split("/").pop();return e.replace(t,"")}return{fetchAccountInfo:function(){function e(){ft.showMessage("Fetching User Info from Dropbox")}function t(e,t,n){var r=JSON.parse(n.responseText);ft.showMessage("Sup "+r.display_name)}function n(){alert("Roh-roh. Something went wrong. :(")}var r={type:"GET",dataType:"json",url:"/account/dropbox",beforeSend:e,error:n,success:t};$.ajax(r)},fetchMetadata:function(){function e(){ft.showMessage("Fetching Metadata")}function t(e,t,n){var r=JSON.parse(n.responseText);window.console&&window.console.log&&console.dir(r)}function n(){alert("Roh-roh. Something went wrong. :(")}var r={type:"GET",dataType:"json",url:"/dropbox/metadata",beforeSend:e,error:n,success:t};$.ajax(r)},searchDropbox:function(){function e(){ft.showMessage("Searching for .md Files")}function t(e,t,r){e=t=null;var i=JSON.parse(r.responseText);if(i.hasOwnProperty("statusCode")&&i.statusCode===401){var s=JSON.parse(i.data);return ft.showMessage("Error! "+s.error,1e3),setTimeout(function(){ft.showMessage("Reloading!"),window.location.reload()},1250)}i.length?n(i):ft.showMessage("No .md files found!")}function r(e,t){alert(e.responseText||"Roh-roh. Something went wrong. :(")}var i={type:"GET",dataType:"json",url:"/import/dropbox",beforeSend:e,error:r,success:t};$.ajax(i)},fetchMarkdownFile:function(t){function n(t,n,r){r=JSON.parse(r.responseText);if(r.statusCode===404){var i=JSON.parse(r.data);ft.showMessage(i.error)}else $("#modal-generic").modal("hide"),z(s.current_filename),L(),e.getSession().setValue(r.data),R()}function o(){alert("Roh-roh. Something went wrong. :(")}var u=r(t),a=i(t);t=a+u;var f={type:"POST",dataType:"json",data:"mdFile="+t,url:"/fetch/dropbox",error:o,success:n};$.ajax(f)},setFilePath:function(e){e=i(e),E({dropbox:{filepath:e}})},putMarkdownFile:function(){function t(e,t,n){e=t=null,n=JSON.parse(n.responseText);if(n.statusCode>=204){var r=JSON.parse(n.data);ft.showMessage(r.error,5e3)}else $("#modal-generic").modal("hide"),ft.showMessage(ft.messages.docSavedDropbox)}function n(){alert("Roh-roh. Something went wrong. :(")}var r=encodeURIComponent(e.getSession().getValue()),i="pathToMdFile="+s.dropbox.filepath+encodeURIComponent(s.current_filename)+".md"+"&fileContents="+r,o={type:"POST",dataType:"json",data:i,url:"/save/dropbox",error:n,success:t};$.ajax(o)}}}();M()}),window.onload=function(){var e=$("#loading");$.support.transition?e.bind($.support.transitionEnd,function(){$("#main").removeClass("bye"),e.remove()}).addClass("fade_slow"):($("#main").removeClass("bye"),e.remove()),window.ace.edit("editor").session.on("changeScrollTop",syncPreview),window.ace.edit("editor").session.selection.on("changeCursor",syncPreview)}